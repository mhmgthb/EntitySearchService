openapi: 3.0.0
info:
  title: Entity Search Service
  description: This is an abstraction for entity search service exposed on Elastic
    Search platform
  version: 1.0.0

tags:
  - name: search
    description: This is entity search service
  - name: aggregate
    description: This is to retrieve aggregate query results
paths:
  /search/{entityName}:
    post:
      tags:
        - search
      summary: Search entity using elastic search service
      description: Search entity using search service
      operationId: searchEnity
      parameters:
        - name: entityName
          in: path
          required: true
          schema:
            "$ref": "#/components/schemas/EntityName"
      requestBody:
        description: search Criteria will contain all filters and other criteria to search entity
        content: { application/json: {
            schema: {
              $ref: '#/components/schemas/SearchRequest'
          }
        }
      }
        required: true
      responses:
        "200":
          description: Success
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/SearchResponse'
            }
          }
          }
        "400":
          description: Bad request
          content: { application/json: {
                            schema: {
                              "$ref": '#/components/schemas/Error'
                            }
                       }
                   }
        "404":
          description: Entity not found
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
        "409":
          description: Validation error
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
        "500":
          description: Internal server error
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
        "501":
          description: The request method is not supported (Not Implemented)
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
        "502":
          description: Service unavailable due to invalid backend response(Bad Gateway)
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
        "503":
          description: Service unavailable (Under maintenance or overloaded)
          content: { application/json: {
            schema: {
              "$ref": '#/components/schemas/Error'
            }
          }
          }
    x-codegen-request-body-name: searchRequest
components:
  schemas:
    EntityName:
      enum:
        - Contracts
        - Employees
        - Profiles
        - Companies
        - Establishments
        - Laborers
        - Trainings
        - Certificates
        - Qualifications
        - Notifications
        - Occupations
      type: string
    SearchRequest:
      required:
        - filters
        - offset
        - orders
        - size
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
        filters:
          type: array
          items:
            $ref: '#/components/schemas/Filter'
        orders:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        size:
          type: integer
          minimum: 1
          maximum: 50
        offset:
          type: integer
          minimum: 0
    Order:
      required:
        - asc
        - field
      type: object
      properties:
        field:
          type: string
          nullable: false
        asc:
          type: boolean
    Filter:
      required:
        - field
        - operator
        - value
      type: object
      properties:
        field:
          type: string
          nullable: false
        operator:
          type: string
          enum:
            - eq
            - ne
            - any
            - gt
            - gte
            - lt
            - lte
            - between
            - not_between
        value:
          type: string
    Error:
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
    SearchResponse:
      required:
        - totalRecords
        - records
      properties:
        totalRecords:
          type: integer
          format: int32
        records:
          type: array
          items:
            $ref: '#/components/schemas/EstablishmentInfo'
    EstablishmentInfo:
      establishmentId:
        type: integer
        format: int32
      laborOfficeId:
        type: integer
        format: int32
      sequenceNumber:
        type: integer
        format: int32
      creationDate: string
      establishmentSizeId: string
      establishmentSizeName: string
      establishmentSizeNameEn: string
      unLaborOfficeId:
        type: integer
        format: int32
      unSequenceNumber:
        type: integer
        format: int32
      establishmentName: string
      crNumber: string
      crIssueDate:
        hijri: string
        gregorian: string
      crExpiryDate:
        Hijri: string
        Gregorian: string
      nationality:
        code:
          type: integer
          format: int32
        nameAr: string
        nameEn: string
      establishmentType:
        code:
          type: integer
          format: int32
        nameAr: string
        nameEn: string
      contactAddress:
        personFirstName: string
        personLastName: string
        personMobileNumber: string
        email: string
        city:
          code:
            type: integer
            format: int32
          nameAr: string
          nameEn: string
        zipCode: string
        streetName: string
        buildingNo:
          type: integer
          format: int32
        district: string
        additionalNo:
          type: integer
          format: int32
        addressDescription: string
        unitNo:
          type: integer
          format: int32
        coordinates:
          Longitude: string
          Latitude: string
      nnifiedNumberId: 0
      sevenHundredNumber: string
      nationalUnifiedNumber: string
      isic4Activity:
        ID:
          type: integer
          format: int32
        Name: string
      isMain:
        type: integer
        format: int32
      status:
        code:
          type: integer
          format: int32
        NameAr: string
        NameEn: string
      unifiedNumberManager:
        ID:
          type: integer
          format: int32
        Name: string
      EstablishmentManagersList:
        EstablishmentManager:
          - ID:
              type: integer
              format: int32
            Name: string
      NewLaborOffice:
        ID:
          type: integer
          format: int32
        Name: string
      FinancialYear:
        Hijri:
          type: integer
          format: int32
        Gregorian: string
      NitaqatLevel:
        CurrentSaudPerc:
          type: integer
          format: int32
        EconomicActivity:
          ID:
            type: integer
            format: int32
          Name: string
        EntityCurrentColor:
          ID:
            type: integer
            format: int32
          Name: string
        SaudisCount:
          type: integer
          format: int32
        NonSaudisCount:
          type: integer
          format: int32
        TotalLaborersCount:
          type: integer
          format: int32
        EntityTotalCount: string
        EntitySaudisCount: string
        EntityForeignersCount: string
        EntitySaudisTotalFactorized: string
        EntityForeignersTotalFactorized: string
      OwnersInfo:
        Owner:
          - OwnerName: string
            IDNumber:
              type: integer
              format: int32
            OwnerTypeId: 0
            type: integer
            format: int32
            Birthdate: string
            Email: string
            MobileNumber: string
            IsCRRepresentative: 0
            StreetName: string
            ZipCode: string
            BuildingNo: string
            Gender:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            City:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            RelationType:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            Nationality:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
      LicensesInfo:
        License:
          - LicenseType:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            LicenseNumber: string
            LicenseName: string
            LicenseSource: string
            LicenseStatus:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            LicenseIssueDate:
              Hijri:
                type: integer
                format: int32
              Gregorian: string
            LicenseExpiryDate:
              Hijri: string
              Gregorian: string
            LicenseArea: string
            LicenseAttachementId: 0
      LocationsInfo:
        Location:
          - LocationId: string
            LocationName: string
            LocationDescription: string
            LocationAddress: string
            LocationStatus:
              Code:
                type: integer
                format: int32
              NameAr: string
              NameEn: string
            MunicipalLicenseId: 0
            MunicipalLicenseStartDate: string
            MunicipalLicenseExpiryDate: string
            Isic4Activity:
              ID:
                type: integer
                format: int32
              Name: string
            NBSaudis:
              type: integer
              format: int32
            NBForeigners:
              type: integer
              format: int32
      HasSubscription:
      HasPrivilege: 0
      HasEFMPrivilege: 0
      HasClosePrivilege: 0
      HasChangeActivityPrivilege: 0
